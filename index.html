<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tree Species Finder / El Buscador de Arboles</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font */
        body {
            font-family: "Inter", sans-serif;
            background-color: #f0f4f8; /* Light blue-grey background */
        }
        /* Style for the address link */
        .address-link {
            color: #2563eb; /* Blue color for links */
            text-decoration: underline;
            cursor: pointer;
        }
        .address-link:hover {
            color: #1d4ed8; /* Darker blue on hover */
        }
        /* Style for dropdown options to allow specific sizing */
        .species-option .latin {
            font-style: italic;
        }
        /* Style for search results species names */
        .species-result-item .latin {
            font-style: italic;
        }
    </style>
</head>
<body class="p-4 sm:p-6 lg:p-8 flex items-center justify-center min-h-screen">
    <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-xl w-full max-w-lg">
        <h1 class="text-3xl font-bold mb-6 text-center text-gray-800">Tree Species Finder / El Buscador de Arboles</h1>

        <div class="mb-6">
            <label for="species-select" class="block text-gray-700 text-sm font-medium mb-2">
                What tree species are you interested in? / ¿Qué especies de árboles te interesan?
            </label>
            <select
                id="species-select"
                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-gray-800 transition duration-200"
            >
                <option value="">-- select here / seleccione aquí --</option>
                <!-- Species Options will be populated by JavaScript -->
            </select>
        </div>

        <div class="mb-6">
            <p class="block text-gray-700 text-sm font-medium mb-2">
                Or search by library or park name here / buscar ubicación aquí:
            </p>
            <select
                id="location-select"
                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-gray-800 transition duration-200"
            >
                <option value="">-- select here / seleccione aquí --</option>
                <!-- Location Options will be populated by JavaScript -->
            </select>
        </div>

        <div class="mt-4 mb-8 flex justify-end">
            <button
                id="refresh-button"
                class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:shadow-lg transition duration-300 ease-in-out transform hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75 flex items-center"
                title="Reset / Reiniciar"
            >
                Reset / Reiniciar
            </button>
        </div>

        <div id="results" class="mt-8 p-4 bg-blue-50 rounded-lg border border-blue-200 shadow-inner">
            <p class="text-gray-600 text-center">Results will appear here / Los resultados aquí</p>
        </div>
    </div>

    <script>
        // This is the species-to-library mapping data from the uploaded CSV.
        const speciesLibraryMappingCSV = `Common Name,Spanish Name,Latin Name,Butler Hike-and-Bike Trail,Butler Park,Carver Library,Central Library,Cepeda Library,Hampton Library,Howson Library,John Gillum Library,Little Walnut Creek Library,Menchaca Library,Milwood Library,PDC,Pease Park,Pleasant Hill Library,Ruiz Library,Southeast Library,Terrazas Library,Twin Oaks Library,University Hills Library,Willie Mae Kirk Library,Windsor Park Library,Yarborough Library
Bigtooth Maple,Arce Palo de Azúcar,Acer grandidentatum,,Yes,,,,,,,,,,,,,,,,,,,,
Boxelder,Arce Negundo,Acer negundo,,Yes,,,Yes,,,,,,,,,,,,,,Yes,,,Yes
Anacaho Orchid Tree,Pata de Cabra Blanca,Bauhinia lunarioides,,Yes,,Yes,,,Yes,Yes,,,,,,,,Yes,,,,,,
Pecan,Pecán,Carya illinoensis,,Yes,,,Yes,,Yes,Yes,,,,Yes,,Yes,,,Yes,,,Yes,,Yes
Sugar Hackberry,Palo Blanco,Celtis laevigata,,Yes,,,Yes,,,Yes,,Yes,Yes,,,Yes,,,,,,Yes,,Yes
Texas Redbud,Cercis tejano,Cercis canadensis var. texensis,,Yes,Yes,,,,,,Yes,Yes,,Yes,,,Yes,Yes,,,Yes,,,
Desert Willow,Mimbre,Chilopsis linearis,,Yes,,Yes,,,,,,,,Yes,,,,,Yes,,,,,Yes
Chitalpa,Chitalpa,Chitalpa tashkentensis ,,,,,,Yes,,,,,,,,,,,,Yes,,,,
Leyland Cypress,Ciprés de Leyland,Cupressus × leylandii,,,,,,,,Yes,,,,,,,,,,,,,,
Arizona Cypress,Ciprés de Arizona,Cupressus arizonica,,,,,,,,,,,,,,,,,,Yes,,,,
Texas Mountian Laurel,Colorín,Dermatophyllum secundiflorum,,Yes,,Yes,Yes,Yes,Yes,,,,Yes,,,,,,,,Yes,,Yes,
Texas Persimmon,Chapote negro,Diospyros texana,,Yes,,,,Yes,,,Yes,,Yes,,,,,,,Yes,,,,
Texas Ash,Fresno Blanco Americano,Fraxinus albicans,,,,Yes,,Yes,,,Yes,,Yes,,,,,,,Yes,,,,
Arizona Ash,Fresno de Arizona,Fraxinus velutina,,,,,,,,Yes,,Yes,,Yes,,Yes,,,,,,Yes,,
Possumhaw Holly,Acebo de Pantano,Ilex decidua,,Yes,,Yes,,,,,,,,,,,,Yes,Yes,,,,,
Yaupon Holly,Acebo Yaupón,Ilex vomitoria,,Yes,Yes,,,,Yes,,,,,,,Yes,Yes,Yes,,,Yes,,,
Ashe Juniper,Enebro de Frutos Azules,Juniperus asheii,,,,,,,,,,,Yes,,,Yes,Yes,Yes,,,,,,
Eastern Red Cedar,Enebro de Virginia,Juniperus virginiana,,,,,,,,,,,,,,,,,,,,,,
Crape Myrtle,Árbol de Júpiter,Lagerstroemia indica,,Yes,Yes,,,,Yes,,Yes,Yes,Yes,Yes,,Yes,,Yes,,,Yes,,,
Golden-Ball Leadtree,Árbol Peto,Leucaena retusa,,,,Yes,,,Yes,,,,,,,,,,,,,,,
Privet,Ligustros,Ligustrum lucidum,,,,,,,,,,,,,,Yes,,,,,,,,
Sweetgum,Liquidámbar,Liquidambar styraciflua,,,,,,,,,,,,,,,,,,,,,,Yes
Osage Orange,Naranjo de los Osages,Maclura pomifera,,,,,,,,,,,,,,,,,,,,Yes,,
Chinaberry,Cinamomo,Melia azedarach,,Yes,,,Yes,,,,,,,Yes,,,,,,,,,,Yes
Wax Myrtle,Árbol de la Cera,Morella cerifera,,,Yes,,,,,,,,,,,,,,,,,,,
Mulberry,Morera,Morus sp.,,Yes,,,Yes,,,,,Yes,,,,,Yes,,,,,,,
Mesquite,Mezquite,Neltuma glandulosa,,,,Yes,,,,,,,,,,,Yes,Yes,,,,,,
Palo Verde,Palo Verde,Parkinsonia aculeata,,,,,,,,,,,,,,,,,,,,,,Yes
Chinese Pistache,Pistacho Chino ,Pistacia chinensis,,,,,Yes,Yes,,,,Yes,,,,,,,,,,,,Yes
Mexican Sycamore,Sicomoro Mexicano,Platanus mexicana,,,,Yes,,,,,,,,Yes,,,,,,,,,,
American Sycamore,sicomoro americano,Platanus occidentalis,,,,,,,Yes,,,,,,,,Yes,,,,,,,
Asiatic Arborvitae,Tuya Asiática,Platycladus orientalis,,Yes,,,,,,,,,,,,,,,,,,,,
Cottonwood,Chopo Americano ,Populus deltoides,,Yes,,,Yes,,,,,,,,,,,,,,Yes,,,
Cherry Laurel,,Prunus caroliniana,,,Yes,,,,,,,,,,,,,,,,,,,
Mexican Plum,Ciruelo Mexicano ,Prunus mexicana,,,,,,Yes,,,,,,,,Yes,,Yes,,Yes,,,Yes,
Pomegranate,Granada,Punica granatum,,,,,,,,,,,,,,,,..,,,Yes,
Bradford Pear,Peral de Flor,Pyrus calleryana,,,,,Yes,Yes,,,,,,,,,,,,,,,,
Live Oak,Encino,Quercus fusiformis,,,,,,Yes,,,,Yes,Yes,,,Yes,,,,,,Yes,,
Lacey Oak,Encino Azul,Quercus laceyi,,Yes,,,,,,,,..Yes,,,,,,,Yes,,,Yes
Bur Oak,Roble Bur,Quercus macrocarpa,,Yes,,,Yes,,,,Yes,,,,,,Yes,Yes,Yes,Yes,,,Yes,
Chinkapin Oak,Encino de Piedras,Quercus muhlenbergii,,Yes,Yes,,,Yes,,Yes,,,,,,,,Yes,Yes,,,,,
Monterrey Oak,Encino Roble,Quercus polymorpha,,,Yes,,,Yes,,Yes,,,,Yes,,,,,Yes,Yes,Yes,,Yes,
Shumard Oak,Encino de Shumard,Quercus shumardii,,Yes,Yes,,,,Yes,,,,,Yes,,,Yes,,Yes,,Yes,Yes,,
Live Oak,Encino,Quercus virginiana,,Yes,,Yes,,,Yes,,Yes,,,Yes,,Yes,Yes,Yes,Yes,Yes,Yes
Black Willow,Sauce Negro,Salix nigra,,Yes,,,,,,,,,,,,,,,,,,,,
Soapberry,Jaboncillo,Sapindus saponaria,,,,,,,,,,,,,,,,..,,,Yes,
Gum Bumelia,Coma,Sideroxylon lanuginosum,,,,,,,,..Yes,,,,,Yes,,,,,,,
Baldcypress,Ciprés de los Pantanos,Taxodium distichum,,Yes,,Yes,,,,,,,,Yes,,Yes,,,,Yes,,,,
Chinese Tallow,Árbol de sebo,Triadica sebifera,,Yes,,,,,,,,,,,,,,,,,,,,Yes
American Elm,Olmo americano,Ulmus americana,,Yes,,,Yes,,,,,,,,..,,,Yes,,,,
Cedar Elm,Cedro Olmo,Ulmus crassifolia,,Yes,Yes,Yes,Yes,Yes,Yes,Yes,Yes,Yes,Yes,Yes,,Yes,Yes,Yes,Yes,,,Yes,Yes,Yes
Lacebark Elm,Olmo Chino,Ulmus parvifolia,,,,,,,,Yes,,,,,,,,,,Yes,,,,Yes
Mexican Buckeye,Monilla,Ungnadia speciosa,,,,..Yes,,Yes,,,,,,,,..Yes,,,Yes,
Chaste Tree,Sauce Gatillo,Vitex agnus-castus,,,,,,,,,,,,,,,,Yes,,,,,,
Prickly Ash,Árbol de Dolor de Dientes,Zanthoxylum hirsutum,,,,,,,,,,,Yes,,,,,,,,,,,`;

        // This is the new address data from the most recent CSV upload.
        const addressCSV = `Location,Address
Butler Hike-and-Bike Trail,100 Trail Ave
Butler Park,2100 Barton Springs Rd
Carver Library,1161 Angelina St
Central Library,710 W Cesar Chavez St
Cepeda Library,651 N Pleasant Valley Rd
Hampton Library,5125 Convict Hill Rd
Howson Library,2500 Exposition Blvd
John Gillum Library,6700 Circle S Rd
Little Walnut Creek Library,7200 Hart Ln
Menchaca Library,5500 Menchaca Rd
Milwood Library,12500 Amberglen Blvd
PDC,5507 S IH 35 Frontage Rd
Pease Park,1100 Kingsbury St
Pleasant Hill Library,700 W William Cannon Dr
Ruiz Library,1600 Grove Blvd
Southeast Library,5803 Nuckols Crossing Rd
Spicewood Springs,8637 Spicewood Springs Rd
Terrazas Library,1105 E Cesar Chavez St
Twin Oaks Library,1801 S 5th St
University Hills Library,4721 Loyola Ln
Willie Mae Kirk Library,3101 Oak Springs Dr
Windsor Park Library,5833 Westminster Dr
Yarborough Library,2200 Hancock Dr`;

        // Function to parse the address CSV into a mapping object
        function parseAddressCSV(csv) {
            const lines = csv.trim().split('\n');
            const addressMap = {};
            // Start from the second line to skip headers
            for (let i = 1; i < lines.length; i++) {
                const parts = lines[i].split(',');
                if (parts.length >= 2) {
                    const location = parts[0].trim();
                    const address = parts.slice(1).join(',').trim(); // Join parts in case address contains commas
                    addressMap[location] = address;
                }
            }
            return addressMap;
        }

        // Parse the address CSV to create the libraryAddresses map
        const libraryAddresses = parseAddressCSV(addressCSV);

        // Function to parse species-library mapping CSV data into a structured array of objects
        function parseSpeciesLibraryCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(','); // Split by comma for headers

            // Library names start from the 4th column (index 3)
            const libraryNames = headers.slice(3);
            const parsedData = [];

            for (let i = 1; i < lines.length; i++) {
                // Skip empty lines or lines with insufficient data that might result from trailing newlines or malformed rows in the CSV
                if (lines[i].trim() === '') {
                    continue;
                }
                const parts = lines[i].split(',');

                // Ensure that the row has at least the common, spanish, and latin name columns (3 columns)
                // Plus the number of library columns defined in headers.
                if (parts.length < 3 + libraryNames.length) {
                    console.warn(`Skipping malformed row in species CSV: "${lines[i]}" - Not enough expected columns.`);
                    continue;
                }

                // Extract Common Name, Spanish Name, and Latin Name
                const commonName = parts[0] ? parts[0].trim() : '';
                const spanishName = parts[1] ? parts[1].trim() : '';
                const latinName = parts[2] ? parts[2].trim() : '';

                for (let j = 0; j < libraryNames.length; j++) {
                    // Ensure the part for the specific library exists before trimming
                    const cellValue = parts[j + 3] ? parts[j + 3].trim() : ''; // +3 to account for Common, Spanish, Latin Name
                    const libraryName = libraryNames[j].trim();
                    if (cellValue === 'Yes' || cellValue === 'X') {
                        parsedData.push({
                            commonName: commonName,
                            spanishName: spanishName,
                            latinName: latinName,
                            library: libraryName,
                            // Lookup the address from the libraryAddresses object
                            address: libraryAddresses[libraryName] || "Address Not Available"
                        });
                    }
                }
            }
            return parsedData;
        }

        // Parse the species-library mapping CSV data
        const treeData = parseSpeciesLibraryCSV(speciesLibraryMappingCSV);

        // Get DOM elements
        const speciesSelectDropdown = document.getElementById('species-select');
        const locationSelectDropdown = document.getElementById('location-select'); // New dropdown for locations
        const resultsDiv = document.getElementById('results');
        const refreshButton = document.getElementById('refresh-button');

        // Function to populate the species dropdown with unique species
        function populateSpeciesDropdown() {
            const uniqueSpeciesInfo = [];
            const seenCombinations = new Set();

            treeData.forEach(item => {
                const combinationKey = `${item.commonName}|${item.spanishName}|${item.latinName}`;
                if (!seenCombinations.has(combinationKey)) {
                    uniqueSpeciesInfo.push({
                        common: item.commonName,
                        spanish: item.spanishName,
                        latin: item.latinName
                    });
                    seenCombinations.add(combinationKey);
                }
            });

            uniqueSpeciesInfo.sort((a, b) => a.common.localeCompare(b.common));

            speciesSelectDropdown.innerHTML = '<option value="">-- select here / seleccione aquí --</option>';
            uniqueSpeciesInfo.forEach(species => {
                const option = document.createElement('option');
                option.value = species.common;
                option.innerHTML = `<span class="font-bold">${species.common}</span> / <span class="text-sm">${species.spanish}</span> / <span class="text-sm italic">${species.latin}</span>`;
                speciesSelectDropdown.appendChild(option);
            });
        }

        // Function to populate the location dropdown with unique library/park names and addresses
        function populateLocationDropdown() {
            const uniqueLocations = new Map(); // Using a Map to maintain order and unique keys
            for (const loc in libraryAddresses) {
                uniqueLocations.set(loc, libraryAddresses[loc]);
            }

            // Convert to array and sort alphabetically by location name
            const sortedLocations = Array.from(uniqueLocations.entries()).sort(([nameA,], [nameB,]) => nameA.localeCompare(nameB));

            locationSelectDropdown.innerHTML = '<option value="">-- select here / seleccione aquí --</option>';
            sortedLocations.forEach(([locationName, address]) => {
                const option = document.createElement('option');
                option.value = locationName; // The value is the location name for lookup
                option.innerHTML = `<span class="font-bold">${locationName}</span> - ${address}`;
                locationSelectDropdown.appendChild(option);
            });
        }

        // Function to display results for the selected tree species
        function displayTreeSpeciesResults(selectedSpecies) {
            const lowerCaseSelectedSpecies = selectedSpecies.toLowerCase().trim();

            if (!lowerCaseSelectedSpecies) {
                resultsDiv.innerHTML = '<p class="text-gray-600 text-center">Results will appear here / Los resultados aquí</p>';
                return;
            }

            const matchedEntries = treeData.filter(item =>
                item.commonName.toLowerCase() === lowerCaseSelectedSpecies
            );

            if (matchedEntries.length === 0) {
                resultsDiv.innerHTML = `<p class="text-red-600 text-center">No results found for "${selectedSpecies}".</p>`;
                return;
            }

            const uniqueLibraries = new Map(); // Map<libraryName, address>
            let displayCommonName = selectedSpecies;
            let displaySpanishName = "";
            let displayLatinName = "";

            const firstMatchedEntry = matchedEntries[0];
            if (firstMatchedEntry) {
                displayCommonName = firstMatchedEntry.commonName;
                displaySpanishName = firstMatchedEntry.spanishName;
                displayLatinName = firstMatchedEntry.latinName;
            }

            matchedEntries.forEach(entry => {
                uniqueLibraries.set(entry.library, entry.address);
            });

            let resultsHtml = `<h2 class="text-xl font-semibold mb-3 text-gray-700">Found "${displayCommonName} / ${displaySpanishName} / <i>${displayLatinName}</i>" at:</h2>`;
            resultsHtml += '<ul class="list-disc pl-5 space-y-2">';
            if (uniqueLibraries.size === 0) {
                resultsHtml += `<p class="text-red-600 text-center">No specific library locations found for "${selectedSpecies}".</p>`;
            } else {
                const sortedLibraries = Array.from(uniqueLibraries.entries()).sort(([nameA,], [nameB,]) => nameA.localeCompare(nameB));

                sortedLibraries.forEach(([libraryName, address]) => {
                    const googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(address + ", Austin, TX")}`;
                    resultsHtml += `
                        <li class="text-gray-800">
                            <strong>${libraryName}</strong><br>
                            <a href="${googleMapsUrl}" target="_blank" rel="noopener noreferrer" class="address-link text-gray-600 text-sm">
                                ${address}
                            </a>
                        </li>
                    `;
                });
            }
            resultsHtml += '</ul>';

            resultsDiv.innerHTML = resultsHtml;
        }

        // Function to display species found at a specific location
        function displayLocationSpeciesResults(selectedLocation) {
            const lowerCaseSelectedLocation = selectedLocation.toLowerCase().trim();

            if (!lowerCaseSelectedLocation) {
                resultsDiv.innerHTML = '<p class="text-gray-600 text-center">Results will appear here / Los resultados aquí</p>';
                return;
            }

            const locationAddress = libraryAddresses[selectedLocation];
            const googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(locationAddress + ", Austin, TX")}`;

            const speciesAtLocation = treeData.filter(item =>
                item.library.toLowerCase() === lowerCaseSelectedLocation
            );

            if (speciesAtLocation.length === 0) {
                resultsDiv.innerHTML = `
                    <h2 class="text-xl font-semibold mb-3 text-gray-700">${selectedLocation}</h2>
                    <p class="text-gray-800 mb-4">
                        <a href="${googleMapsUrl}" target="_blank" rel="noopener noreferrer" class="address-link text-lg">
                            ${locationAddress}
                        </a>
                    </p>
                    <p class="text-red-600 text-center">No tree species listed for "${selectedLocation}".</p>
                `;
                return;
            }

            const uniqueSpeciesInfo = [];
            const seenCombinations = new Set();
            speciesAtLocation.forEach(item => {
                const combinationKey = `${item.commonName}|${item.spanishName}|${item.latinName}`;
                if (!seenCombinations.has(combinationKey)) {
                    uniqueSpeciesInfo.push({
                        common: item.commonName,
                        spanish: item.spanishName,
                        latin: item.latinName
                    });
                    seenCombinations.add(combinationKey);
                }
            });

            uniqueSpeciesInfo.sort((a, b) => a.common.localeCompare(b.common));

            let resultsHtml = `
                <h2 class="text-xl font-semibold mb-3 text-gray-700">${selectedLocation}</h2>
                <p class="text-gray-800 mb-4">
                    <a href="${googleMapsUrl}" target="_blank" rel="noopener noreferrer" class="address-link text-lg">
                        ${locationAddress}
                    </a>
                </p>
                <h3 class="text-lg font-medium mb-2 text-gray-700">Species found here:</h3>
                <ul class="list-disc pl-5 space-y-2">
            `;

            uniqueSpeciesInfo.forEach(species => {
                resultsHtml += `
                    <li class="text-gray-800 species-result-item">
                        <strong>${species.common}</strong> / <span class="text-sm">${species.spanish}</span> / <span class="text-sm italic">${species.latin}</span>
                    </li>
                `;
            });

            resultsHtml += '</ul>';
            resultsDiv.innerHTML = resultsHtml;
        }


        // Event listener for species select dropdown
        speciesSelectDropdown.addEventListener('change', (event) => {
            const selectedSpecies = event.target.value;
            if (selectedSpecies) {
                locationSelectDropdown.value = ''; // Clear location selection if species is selected
                displayTreeSpeciesResults(selectedSpecies);
            } else {
                resultsDiv.innerHTML = '<p class="text-gray-600 text-center">Results will appear here / Los resultados aquí</p>';
            }
        });

        // Event listener for location select dropdown
        locationSelectDropdown.addEventListener('change', (event) => {
            const selectedLocation = event.target.value;
            if (selectedLocation) {
                speciesSelectDropdown.value = ''; // Clear species selection if location is selected
                displayLocationSpeciesResults(selectedLocation);
            } else {
                resultsDiv.innerHTML = '<p class="text-gray-600 text-center">Results will appear here / Los resultados aquí</p>';
            }
        });

        // Event listener for the refresh button
        refreshButton.addEventListener('click', () => {
            speciesSelectDropdown.value = ''; // Clear the dropdown selection
            locationSelectDropdown.value = ''; // Clear the location dropdown selection
            resultsDiv.innerHTML = '<p class="text-gray-600 text-center">Results will appear here / Los resultados aquí</p>';
            speciesSelectDropdown.focus(); // Set focus back to the species dropdown
        });

        // Initialize both dropdowns on page load
        document.addEventListener('DOMContentLoaded', () => {
            populateSpeciesDropdown();
            populateLocationDropdown();
        });
    </script>
</body>
</html>
